<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Caixa Academia</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:15px;display:flex;justify-content:space-between;align-items:center}
.container{max-width:1200px;margin:auto;padding:20px}
.card{background:#020617;border-radius:10px;padding:20px;margin-bottom:20px}
input,button{padding:10px;border-radius:6px;border:none}
input{width:100%;margin-bottom:10px;background:#1e293b;color:#e5e7eb}
button{background:#2563eb;color:#fff;cursor:pointer}
button.warn{background:#f59e0b}
button.danger{background:#dc2626}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1e293b;text-align:center}
.hidden{display:none}
.alerta{background:#7c2d12;padding:15px;border-radius:8px;margin-bottom:20px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="container">
  <div class="card" style="max-width:400px;margin:auto">
    <img src="logo.png" style="width:120px;display:block;margin:auto">
    <h3>Login</h3>
    <input id="user" placeholder="Usu치rio">
    <input id="pass" type="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- SISTEMA -->
<div id="sistema" class="hidden">

<header>
  <strong id="infoUser"></strong>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

<div id="alertaAtraso" class="alerta hidden"></div>

<!-- CADASTRO DE ALUNO -->
<div class="card">
  <h3>Cadastrar Aluno</h3>
  <input id="nomeAluno" placeholder="Nome do aluno">
  <input id="valorAluno" placeholder="Mensalidade (R$)" type="number">
  <input id="vencimentoAluno" placeholder="Dia de vencimento (1 a 28)" type="number" min="1" max="28">
  <button onclick="cadastrarAluno()">Cadastrar</button>
</div>

<!-- LISTA DE ALUNOS -->
<div class="card">
  <h3>Lista de Alunos</h3>
  <table>
    <thead>
      <tr><th>Aluno</th><th>Mensalidade</th><th>Status</th><th>A칞칫es</th></tr>
    </thead>
    <tbody id="listaAlunos"></tbody>
  </table>
</div>

<!-- A칂칏ES -->
<div class="card">
  <button onclick="gerarPDF()">游늯 Relat칩rio Mensal (PDF)</button>
  <button class="danger" onclick="fecharCaixa()">游 Fechar Caixa</button>
</div>

</div>
</div>

<script>
const { jsPDF } = window.jspdf;

// Usu치rios do sistema
let users = [
 {user:"admin", pass:"1234"},
 {user:"funcionario", pass:"123"}
];

let usuario = null;
let alunos = JSON.parse(localStorage.getItem("alunos")) || [];
let caixaAberto = localStorage.getItem("caixa") !== "fechado";

// --- LOGIN ---
function login() {
    const username = document.getElementById("user").value.trim();
    const password = document.getElementById("pass").value.trim();

    if(!username || !password) return alert("Preencha usu치rio e senha!");

    const ok = users.find(u => u.user === username && u.pass === password);
    if(!ok) return alert("Login inv치lido");

    usuario = ok;
    document.getElementById("login").style.display = "none";
    document.getElementById("sistema").classList.remove("hidden");
    document.getElementById("infoUser").innerText = "Usu치rio: " + usuario.user;

    atualizar();
    verificarAtrasos();
}

// Logout
function logout() {
    location.reload();
}

// --- CADASTRO DE ALUNO ---
function cadastrarAluno() {
    const nome = document.getElementById("nomeAluno").value.trim();
    const valor = Number(document.getElementById("valorAluno").value);
    const vencimento = Number(document.getElementById("vencimentoAluno").value);

    if(!nome || !valor || !vencimento) return alert("Preencha todos os campos corretamente!");

    alunos.push({ nome, valor, vencimento, ultimoPagamento: null });
    salvar();

    document.getElementById("nomeAluno").value = "";
    document.getElementById("valorAluno").value = "";
    document.getElementById("vencimentoAluno").value = "";

    atualizar();
    verificarAtrasos();
}

// --- PAGAMENTO ---
function receber(i) {
    if(!caixaAberto) return alert("Caixa fechado!");
    alunos[i].ultimoPagamento = new Date().toISOString();
    salvar();
    atualizar();
    verificarAtrasos();
}

// --- ATRASOS ---
function verificarAtrasos() {
    const hoje = new Date();
    let atrasados = [];

    alunos.forEach(a => {
        const ult = a.ultimoPagamento ? new Date(a.ultimoPagamento) : null;
        const venc = new Date(hoje.getFullYear(), h
