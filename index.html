<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema Academia</title>

<style>
body { font-family: Arial; background:#f2f2f2; margin:0 }
.card { background:#fff; padding:20px; border-radius:8px; max-width:400px; margin:40px auto }
input, button { width:100%; padding:10px; margin-top:8px }
button { cursor:pointer }
#sistema { display:none }
.topo { background:#222; color:#fff; padding:10px; display:flex; justify-content:space-between; align-items:center }
.caixa { max-width:900px; margin:20px auto }
table { width:100%; border-collapse:collapse }
th, td { border:1px solid #ccc; padding:8px; text-align:center }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
  <img src="logo.png" style="width:120px;display:block;margin:auto">
  <h3>Login</h3>
  <input id="user" placeholder="Usuário">
  <input id="pass" type="password" placeholder="Senha">
  <button id="btnLogin">Entrar</button>
</div>

<!-- SISTEMA -->
<div id="sistema">
  <div class="topo">
    <div id="infoUser"></div>
    <div>
      <button onclick="abrirTrocaSenha()">Trocar Senha</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="caixa">

    <h3>Cadastrar Aluno</h3>
    <input id="alunoNome" placeholder="Nome do aluno">
    <input id="alunoValor" placeholder="Mensalidade">
    <button onclick="cadastrarAluno()">Cadastrar</button>

    <h3>Alunos</h3>
    <table>
      <thead>
        <tr>
          <th>Aluno</th>
          <th>Mensalidade</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody id="listaAlunos"></tbody>
    </table>

    <h3>Adicionar Entrada</h3>
    <input id="entradaDesc" placeholder="Descrição">
    <input id="entradaValor" placeholder="Valor">
    <button onclick="addEntrada()">Adicionar Entrada</button>

    <h3>Adicionar Gasto</h3>
    <input id="gastoDesc" placeholder="Descrição">
    <input id="gastoValor" placeholder="Valor">
    <button onclick="addGasto()">Adicionar Gasto</button>

    <h3>Movimentações</h3>
    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Recebido por</th>
        </tr>
      </thead>
      <tbody id="movimentos"></tbody>
    </table>

  </div>
</div>

<script>
// ===== USUÁRIOS =====
let users = JSON.parse(localStorage.getItem("users")) || [
  { user:"admin", pass:"1234", role:"admin" },
  { user:"funcionario", pass:"123", role:"funcionario" }
];

let usuarioLogado = null;
let alunos = JSON.parse(localStorage.getItem("alunos")) || [];
let movimentos = JSON.parse(localStorage.getItem("movimentos")) || [];

// ===== LOGIN =====
document.getElementById("btnLogin").onclick = () => {
  const u = user.value;
  const p = pass.value;
  const achou = users.find(x => x.user === u && x.pass === p);
  if (!achou) return alert("Login inválido");
  usuarioLogado = achou;
  login.style.display = "none";
  sistema.style.display = "block";
  infoUser.innerText = `Usuário: ${achou.user}`;
  atualizar();
};

// ===== LOGOUT =====
function logout() {
  usuarioLogado = null;
  sistema.style.display = "none";
  login.style.display = "block";
}

// ===== TROCAR SENHA =====
function abrirTrocaSenha() {
  const nova = prompt("Nova senha:");
  if (!nova) return;
  const u = users.find(x => x.user === usuarioLogado.user);
  u.pass = nova;
  localStorage.setItem("users", JSON.stringify(users));
  alert("Senha alterada");
}

// ===== ALUNOS =====
function cadastrarAluno() {
  const nome = alunoNome.value;
  const valor = alunoValor.value;
  if (!nome || !valor) return;
  alunos.push({ nome, valor });
  localStorage.setItem("alunos", JSON.stringify(alunos));
  alunoNome.value = "";
  alunoValor.value = "";
  atualizar();
}

function pagarMensalidade(nome, valor) {
  movimentos.push({
    tipo:"Entrada",
    desc:`Mensalidade - ${nome}`,
    valor,
    por: usuarioLogado.user
  });
  salvarMovimentos();
}

// ===== CAIXA =====
function addEntrada() {
  movimentos.push({
    tipo:"Entrada",
    desc:entradaDesc.value,
    valor:entradaValor.value,
    por:usuarioLogado.user
  });
  salvarMovimentos();
}

function addGasto() {
  movimentos.push({
    tipo:"Gasto",
    desc:gastoDesc.value,
    valor:gastoValor.value,
    por:usuarioLogado.user
  });
  salvarMovimentos();
}

function salvarMovimentos() {
  localStorage.setItem("movimentos", JSON.stringify(movimentos));
  entradaDesc.value = "";
  entradaValor.value = "";
  gastoDesc.value = "";
  gastoValor.value = "";
  atualizar();
}

// ===== ATUALIZAR TELA =====
function atualizar() {
  listaAlunos.innerHTML = "";
  alunos.forEach(a => {
    listaAlunos.innerHTML += `
      <tr>
        <td>${a.nome}</td>
        <td>R$ ${a.valor}</td>
        <td><button onclick="pagarMensalidade('${a.nome}',${a.valor})">Receber</button></td>
      </tr>`;
  });

  movimentos.innerHTML = "";
  movimentos.forEach(m => {
    movimentos.innerHTML += `
      <tr>
        <td>${m.tipo}</td>
        <td>${m.desc}</td>
        <td>R$ ${m.valor}</td>
        <td>${m.por}</td>
      </tr>`;
  });
}
</script>

</body>
</html>
